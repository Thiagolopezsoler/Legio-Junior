<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pac-Man</title>
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background-color: #000;
            color: white;
            font-family: Arial, sans-serif;
        }
        canvas {
            border: 1px solid #fff;
        }
        #gameOver {
            position: absolute;
            color: red;
            font-size: 48px;
        }
    </style>
</head>
<body>
    <canvas id="gameCanvas" width="400" height="400"></canvas>
    <div id="gameOver" style="display: none;">Game Over</div>
    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const gameOverDisplay = document.getElementById('gameOver');

        // Laberinto
        const maze = [
            [1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
            [1, 0, 0, 0, 0, 0, 0, 0, 0, 1],
            [1, 0, 1, 1, 0, 1, 1, 1, 0, 1],
            [1, 0, 0, 0, 0, 0, 0, 0, 0, 1],
            [1, 0, 1, 0, 1, 1, 1, 0, 1, 1],
            [1, 0, 0, 0, 0, 0, 0, 0, 0, 1],
            [1, 0, 1, 1, 0, 1, 1, 1, 0, 1],
            [1, 0, 0, 0, 0, 0, 0, 0, 0, 1],
            [1, 1, 1, 1, 1, 1, 1, 1, 1, 1]
        ];

        // Configuración del jugador (Pac-Man)
        const player = {
            x: 180,
            y: 180,
            radius: 15,
            color: 'yellow',
            speed: 5,
            dx: 0,
            dy: 0,
            powerMode: false,
            powerTime: 0
        };

        // Configuración de los fantasmas
        const ghosts = [
            { x: 100, y: 100, radius: 15, color: 'red', speed: 2, scared: false },
            { x: 300, y: 100, radius: 15, color: 'pink', speed: 2, scared: false },
            { x: 100, y: 300, radius: 15, color: 'cyan', speed: 2, scared: false },
            { x: 300, y: 300, radius: 15, color: 'orange', speed: 2, scared: false }
        ];

        // Puntos para recolectar
        const dots = [];
        for (let i = 0; i < 50; i++) {
            let x, y;
            do {
                x = Math.random() * (canvas.width - 30) + 15;
                y = Math.random() * (canvas.height - 30) + 15;
            } while (checkWallCollision(x, y));
            dots.push({
                x: x,
                y: y,
                radius: 3,
                color: 'white'
            });
        }

        // Frutas especiales
        const fruits = [
            { x: 200, y: 200, radius: 10, color: 'green' }
        ];

        // Control de teclas
        function keyDownHandler(e) {
            if (e.key === 'Right' || e.key === 'ArrowRight') {
                player.dx = player.speed;
                player.dy = 0;
            } else if (e.key === 'Left' || e.key === 'ArrowLeft') {
                player.dx = -player.speed;
                player.dy = 0;
            } else if (e.key === 'Up' || e.key === 'ArrowUp') {
                player.dy = -player.speed;
                player.dx = 0;
            } else if (e.key === 'Down' || e.key === 'ArrowDown') {
                player.dy = player.speed;
                player.dx = 0;
            }
        }

        // Dibujar Pac-Man
        function drawPlayer() {
            ctx.beginPath();
            ctx.arc(player.x, player.y, player.radius, 0.2 * Math.PI, 1.8 * Math.PI); // Boca de Pac-Man
            ctx.lineTo(player.x, player.y);
            ctx.fillStyle = player.color;
            ctx.fill();
            ctx.closePath();
        }

        // Dibujar fantasmas
        function drawGhosts() {
            ghosts.forEach(ghost => {
                ctx.beginPath();
                ctx.arc(ghost.x, ghost.y, ghost.radius, 0, Math.PI * 2);
                ctx.fillStyle = ghost.scared ? 'blue' : ghost.color;
                ctx.fill();
                ctx.closePath();
            });
        }

        // Dibujar puntos
        function drawDots() {
            dots.forEach(dot => {
                ctx.beginPath();
                ctx.arc(dot.x, dot.y, dot.radius, 0, Math.PI * 2);
                ctx.fillStyle = dot.color;
                ctx.fill();
                ctx.closePath();
            });
        }

        // Dibujar frutas
        function drawFruits() {
            fruits.forEach(fruit => {
                ctx.beginPath();
                ctx.arc(fruit.x, fruit.y, fruit.radius, 0, Math.PI * 2);
                ctx.fillStyle = fruit.color;
                ctx.fill();
                ctx.closePath();
            });
        }

        // Dibujar laberinto
        function drawMaze() {
            const cellSize = canvas.width / maze[0].length;
            maze.forEach((row, i) => {
                row.forEach((cell, j) => {
                    if (cell === 1) {
                        ctx.fillStyle = 'blue';
                        ctx.fillRect(j * cellSize, i * cellSize, cellSize, cellSize);
                    }
                });
            });
        }

        // Verificar colisiones con las paredes del laberinto
        function checkWallCollision(x, y) {
            const cellSize = canvas.width / maze[0].length;
            const col = Math.floor(x / cellSize);
            const row = Math.floor(y / cellSize);

            // Verificar si las coordenadas están dentro de los límites de la matriz
            if (row >= 0 && row < maze.length && col >= 0 && col < maze[0].length) {
                return maze[row][col] === 1;
            } else {
                // Si las coordenadas están fuera de los límites, considerar como una pared
                return true;
            }
        }

        // Actualizar posición de los fantasmas
        function updateGhosts() {
            ghosts.forEach(ghost => {
                let newX, newY;
                if (player.powerMode) {
                    // Fantasmas huyen de Pac-Man
                    if (ghost.x < player.x) newX = ghost.x - ghost.speed;
                    else newX = ghost.x + ghost.speed;
                    if (ghost.y < player.y) newY = ghost.y - ghost.speed;
                    else newY = ghost.y + ghost.speed;
                } else {
                    // Fantasmas persiguen a Pac-Man
                    if (ghost.x < player.x) newX = ghost.x + ghost.speed;
                    else newX = ghost.x - ghost.speed;
                    if (ghost.y < player.y) newY = ghost.y + ghost.speed;
                    else newY = ghost.y - ghost.speed;
                }

                if (!checkWallCollision(newX, ghost.y)) ghost.x = newX;
                if (!checkWallCollision(ghost.x, newY)) ghost.y = newY;
            });
        }

        // Verificar colisiones entre Pac-Man y los fantasmas
        function checkCollision() {
            ghosts.forEach((ghost, index) => {
                const dx = player.x - ghost.x;
                const dy = player.y - ghost.y;
                const distance = Math.sqrt(dx * dx + dy * dy);

                if (distance < player.radius + ghost.radius) {
                    if (player.powerMode) {
                        // Pac-Man come al fantasma
                        ghosts.splice(index, 1);
                    } else {
                        gameOver();
                    }
                }
            });
        }

        // Verificar si Pac-Man recolecta un punto
        function checkDotCollision() {
            for (let i = 0; i < dots.length; i++) {
                const dot = dots[i];
                const dx = player.x - dot.x;
                const dy = player.y - dot.y;
                const distance = Math.sqrt(dx * dx + dy * dy);

                if (distance < player.radius + dot.radius) {
                    dots.splice(i, 1);
                    break;
                }
            }

            if (dots.length === 0) {
                alert('¡Ganaste!');
                resetGame();
            }
        }

        // Verificar si Pac-Man recolecta una fruta
        function checkFruitCollision() {
            for (let i = 0; i < fruits.length; i++) {
                const fruit = fruits[i];
                const dx = player.x - fruit.x;
                const dy = player.y - fruit.y;
                const distance = Math.sqrt(dx * dx + dy * dy);

                if (distance < player.radius + fruit.radius) {
                    fruits.splice(i, 1);
                    player.powerMode = true;
                    player.powerTime = 100; // Tiempo en frames
                    ghosts.forEach(ghost => ghost.scared = true);
                    break;
                }
            }
        }

        // Actualizar el modo de poder
        function updatePowerMode() {
            if (player.powerMode) {
                player.powerTime--;
                if (player.powerTime <= 0) {
                    player.powerMode = false;
                    ghosts.forEach(ghost => ghost.scared = false);
                }
            }
        }

        // Reiniciar el juego
        function resetGame() {
            player.x = 180;
            player.y = 180;
            player.dx = 0;
            player.dy = 0;
            player.powerMode = false;
            player.powerTime = 0;

            ghosts.length = 0;
            ghosts.push(
                { x: 100, y: 100, radius: 15, color: 'red', speed: 2, scared: false },
                { x: 300, y: 100, radius: 15, color: 'pink', speed: 2, scared: false },
                { x: 100, y: 300, radius: 15, color: 'cyan', speed: 2, scared: false },
                { x: 300, y: 300, radius: 15, color: 'orange', speed: 2, scared: false }
            );

            dots.length = 0;
            for (let i = 0; i < 50; i++) {
                let x, y;
                do {
                    x = Math.random() * (canvas.width - 30) + 15;
                    y = Math.random() * (canvas.height - 30) + 15;
                } while (checkWallCollision(x, y));
                dots.push({
                    x: x,
                    y: y,
                    radius: 3,
                    color: 'white'
                });
            }

            fruits.length = 0;
            fruits.push({ x: 200, y: 200, radius: 10, color: 'green' });

            gameOverDisplay.style.display = 'none';
        }

        // Fin del juego
        function gameOver() {
            gameOverDisplay.style.display = 'block';
            setTimeout(resetGame, 2000);
        }

        // Bucle principal del juego
        function gameLoop() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Actualizar posición del jugador
            const newX = player.x + player.dx;
            const newY = player.y + player.dy;

            if (!checkWallCollision(newX, newY)) {
                player.x = newX;
                player.y = newY;
            }

            updatePowerMode();
            updateGhosts();
            checkCollision();
            checkDotCollision();
            checkFruitCollision();
            drawMaze();
            drawDots();
            drawFruits();
            drawPlayer();
            drawGhosts();

            requestAnimationFrame(gameLoop);
        }

        // Iniciar el juego
        document.addEventListener('keydown', keyDownHandler);
        gameLoop();
    </script>
</body>
</html>
